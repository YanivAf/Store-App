"use strict";exports.__esModule=!0,exports.purchaseCart=exports.updateLoved=exports.updateSaved=exports.updateQuantity=exports.details=exports.logout=exports.login=exports.register=exports.welcome=void 0;var secret=require("../../secret/dist/secret").secret,jwt=require("jsonwebtoken"),_a=require("../../models/dist/usersModel"),Users=_a.Users,User=_a.User,CartProduct=_a.CartProduct,_b=require("../../models/dist/storesModel"),Product=_b.Product,Store=_b.Store,Stores=_b.Stores;function welcome(e,s){try{var r=e.userIndex,t=e.isAdmin,o=(new Users).users[r],d=o.username,u=o.stores;s.send({isAdmin:t,storeUuid:u[0],h1Text:"Shop Shop Shop",message:d+", you're already logged in"})}catch(e){console.error(e),s.status(500).send(e.message)}}function register(e,s){try{var r=e.body,t=r.email,o=r.username,d=r.password,u=e.shopperToAdmin,n=e.userIndex,a=e.role,c=(new Users).addUser(t,o,d,u,n,a),i=c.userUuid,p=c.storeUuid,l=jwt.sign({userUuid:i},secret,{expiresIn:3600});s.cookie("currentUser",l,{maxAge:36e5,httpOnly:!0}),s.send({title:"Cheers, "+o+"!",text:"You are our newest "+a+"!",storeUuid:p})}catch(e){console.error(e),s.status(500).send(e.message)}}function login(e,s){try{var r,t=e.body.adminLoginForm,o=e.userIndex,d=e.role,u=(new Users).users[o],n=u.username,a=u.userUuid,c=u.stores,i="admin"===d?"n admin":" shopper";!t&&"shopper"===d||t&&"admin"===d?(r=jwt.sign({userUuid:a},secret,{expiresIn:3600}),s.cookie("currentUser",r,{maxAge:36e5,httpOnly:!0}),s.send({title:"Welcome back, "+n+"!",text:"Enjoy your visit!",storeUuid:c[0],isLoggedIn:!0})):s.send({title:n+", you are not a"+i+"!",text:"Please use the right login form!",isLoggedIn:!1})}catch(e){console.error(e),s.status(500).send(e.message)}}function logout(e,s){try{var r=e.userIndex,t=(new Users).users[r].username;s.clearCookie("currentUser"),s.send({username:t})}catch(e){console.error(e),s.status(500).send(e.message)}}function details(e,s){try{var r=e.userIndex,t=e.isAdmin,o=(new Users).users[r];s.send({user:o,isUserAdmin:t})}catch(e){console.error(e),s.status(500).send(e.message)}}function updateQuantity(e,s){try{var r,t=e.body,o=t.productUuid,d=t.productQuantity,u=t.allStoresInfo,n=new Users,a=e.userIndex,c=e.cartProductIndex,i=e.storeUuid,p=e.storeIndex,l=e.productIndex,x=n.updateCartProductQuantity(a,c,p,i,o,l,d),g=n.users[a].savedForLater,m=n.users[a].loved,h=new Stores;u&&(r=[],h.stores.forEach(function(e){r=r.concat(e.products)}));var v=null!=r?r:h.stores[p].products,U=n.users[a].shippingAddress;s.send({cartProducts:x,storeProducts:v,savedProducts:g,lovedProducts:m,shippingAddress:U})}catch(e){console.error(e),s.status(500).send(e.message)}}function updateSaved(e,s){try{var r=e.body.productUuid,t=new Users,o=e.userIndex,d=t.users[o].cart,u=t.unsaveForLater(o,r),n=new Stores,a=[];n.stores.forEach(function(e){a=a.concat(e.products)});var c=t.users[o].shippingAddress;s.send({cartProducts:d,storeProducts:a,savedProducts:u,shippingAddress:c})}catch(e){console.error(e),s.status(500).send(e.message)}}function updateLoved(e,s){try{var r,t=e.body,o=t.productUuid,d=t.allStoresInfo,u=new Users,n=e.userIndex,a=e.storeIndex,c=e.productIndex,i=u.users[n].cart,p=u.updateLovedProducts(n,o,a,c),l=new Stores;d&&(r=[],l.stores.forEach(function(e){r=r.concat(e.products)}));var x=null!=r?r:l.stores[a].products;s.send({cartProducts:i,storeProducts:x,lovedProducts:p})}catch(e){console.error(e),s.status(500).send(e.message)}}function purchaseCart(e,s){try{var r=new Users,t=e.userIndex;r.emptyCart(t),s.send({title:"Cart purchase completed",purchaseCart:!0})}catch(e){console.error(e),s.status(500).send(e.message)}}exports.welcome=welcome,exports.register=register,exports.login=login,exports.logout=logout,exports.details=details,exports.updateQuantity=updateQuantity,exports.updateSaved=updateSaved,exports.updateLoved=updateLoved,exports.purchaseCart=purchaseCart;