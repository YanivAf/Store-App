"use strict";exports.__esModule=!0,exports.purchaseCart=exports.deleteFromCart=exports.updateQuantity=exports.addToCart=exports.details=exports.login=exports.register=exports.welcome=void 0;var secret=require("../../secret/dist/secret").secret,jwt=require("jsonwebtoken"),_a=require("../../models/dist/usersModel"),Users=_a.Users,User=_a.User,_b=require("../../models/dist/storeModel"),Product=_b.Product,Store=_b.Store;function welcome(e,r){try{r.send({h1Text:"Shop Shop Shop",message:"We wish you happy Shopping ðŸ›’"})}catch(e){console.error(e),r.status(500).send(e.message)}}function register(e,r){try{var t,s,o=e.body,a=o.email,d=o.username,n=o.password,u=o.isAdmin,i=u?"admin":"shopper",c=u?"\n\nShopper trying to become an admin? Please verify you credentials.":"",l=(new Users).addUser(a,d,n,u),p=l.userUuid,m=l.storeUuid;p?(t=JSON.stringify({userUuid:p}),s=jwt.sign(t,secret,{expiresIn:"1h"}),r.cookie("currentUser",s,{maxAge:18e6,httpOnly:!0}),r.send({title:"Cheers, "+d+"!",text:"You are our newest "+i+"!",storeUuid:m,isRegistered:!0})):r.send({title:"Email already registered",text:"Please use a different email address."+c,isRegistered:!1})}catch(e){console.error(e),r.status(500).send(e.message)}}function login(e,r){try{var t,s,o,a=e.body,d=a.email,n=a.password,u=a.adminLoginForm,i=u?"n admin":" shopper",c=(new Users).verifyUser(d,n);c?!(t=0===c.stores.length?null:c.stores[0])&&!u||t&&u?(s=JSON.stringify({userUuid:c.userUuid}),o=jwt.sign(s,secret),r.cookie("currentUser",o,{maxAge:18e6,httpOnly:!0}),r.send({title:"Welcome back, "+c.username+"!",text:"Enjoy your visit!",storeUuid:t,isLoggedIn:!0})):r.send({title:c.username+", you are not a"+i+"!",text:"Please use the right login form!",isLoggedIn:!1}):r.send({title:"Credentials are wrong",text:"Please verify.",isLoggedIn:!1})}catch(e){console.error(e),r.status(500).send(e.message)}}function addToCart(e,r){try{var t=e.body,s=t.productUuid,o=t.productName,a=new Users,d=e.userUuid.userUuid;a.addCartProduct(d,s),r.send({title:o+" added to your cart!",addToCart:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}function updateQuantity(e,r){try{var t=e.body,s=t.productUuid,o=t.productName,a=t.mathSign,d=new Users,n=e.userUuid.userUuid,u=d.updateCartProductQuantity(n,s,a);r.send({title:"There are now "+u+" "+o+"(s) in your cart",updateQuantity:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}function deleteFromCart(e,r){try{var t=e.body,s=t.productUuid,o=t.productName,a=new Users,d=e.userUuid.userUuid;a.deleteCartProduct(d,s),r.send({title:"You have delete "+o+" from your cart",deleteFromCart:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}function purchaseCart(e,r){try{var t=new Users,s=e.userUuid.userUuid;t.emptyCart(s),r.send({title:"Cart purchase completed",purchaseCart:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}exports.welcome=welcome,exports.register=register,exports.login=login,exports.details=function(e,r){try{var t=e.userIndex,s=e.isAdmin,o=(new Users).users[t],a=o.username,d=o.cart,n=o.purchased;s?r.send({username:a}):r.send({username:a,cart:d,purchased:n})}catch(e){console.error(e),r.status(500).send(e.message)}},exports.addToCart=addToCart,exports.updateQuantity=updateQuantity,exports.deleteFromCart=deleteFromCart,exports.purchaseCart=purchaseCart;