"use strict";exports.__esModule=!0,exports.purchaseCart=exports.deleteFromCart=exports.updateQuantity=exports.addToCart=exports.details=exports.login=exports.register=exports.welcome=void 0;var secret=require("../../secret/dist/secret").secret,jwt=require("jsonwebtoken"),_a=require("../../models/dist/usersModel"),Users=_a.Users,User=_a.User,_b=require("../../models/dist/storeModel"),Product=_b.Product,Store=_b.Store;function welcome(e,r){try{var s=e.userIndex,t=e.isAdmin,o=(new Users).users[s],a=o.username,d=o.stores;r.send({isAdmin:t,storeUuid:d[0],h1Text:"Shop Shop Shop",message:a+", you're already logged in"})}catch(e){console.error(e),r.status(500).send(e.message)}}function register(e,r){try{var s=e.body,t=s.email,o=s.username,a=s.password,d=e.shopperToAdmin,u=e.userIndex,n=e.role,i=(new Users).addUser(t,o,a,d,u,n),c=i.userUuid,p=i.storeUuid,l=jwt.sign({userUuid:c},secret,{expiresIn:1800});r.cookie("currentUser",l,{maxAge:18e5,httpOnly:!0}),r.send({title:"Cheers, "+o+"!",text:"You are our newest "+n+"!",storeUuid:p})}catch(e){console.error(e),r.status(500).send(e.message)}}function login(e,r){try{var s,t=e.body.adminLoginForm,o=e.userIndex,a=e.role,d=(new Users).users[o],u=d.username,n=d.userUuid,i=d.storeUuid,c="admin"===a?"n admin":" shopper";!t&&"shopper"===a||t&&"admin"===a?(s=jwt.sign({userUuid:n},secret,{expiresIn:1800}),r.cookie("currentUser",s,{maxAge:18e5,httpOnly:!0}),r.send({title:"Welcome back, "+u+"!",text:"Enjoy your visit!",storeUuid:i,isLoggedIn:!0})):r.send({title:u+", you are not a"+c+"!",text:"Please use the right login form!",isLoggedIn:!1})}catch(e){console.error(e),r.status(500).send(e.message)}}function addToCart(e,r){try{var s=e.body,t=s.productUuid,o=s.productName,a=new Users,d=e.userUuid.userUuid;a.addCartProduct(d,t),r.send({title:o+" added to your cart!",addToCart:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}function updateQuantity(e,r){try{var s=e.body,t=s.productUuid,o=s.productName,a=s.mathSign,d=new Users,u=e.userUuid.userUuid,n=d.updateCartProductQuantity(u,t,a);r.send({title:"There are now "+n+" "+o+"(s) in your cart",updateQuantity:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}function deleteFromCart(e,r){try{var s=e.body,t=s.productUuid,o=s.productName,a=new Users,d=e.userUuid.userUuid;a.deleteCartProduct(d,t),r.send({title:"You have delete "+o+" from your cart",deleteFromCart:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}function purchaseCart(e,r){try{var s=new Users,t=e.userUuid.userUuid;s.emptyCart(t),r.send({title:"Cart purchase completed",purchaseCart:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}exports.welcome=welcome,exports.register=register,exports.login=login,exports.details=function(e,r){try{var s=e.userIndex,t=e.isAdmin,o=(new Users).users[s],a=o.username,d=o.cart,u=o.purchased;t?r.send({username:a}):r.send({username:a,cart:d,purchased:u})}catch(e){console.error(e),r.status(500).send(e.message)}},exports.addToCart=addToCart,exports.updateQuantity=updateQuantity,exports.deleteFromCart=deleteFromCart,exports.purchaseCart=purchaseCart;