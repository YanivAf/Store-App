"use strict";exports.__esModule=!0,exports.purchaseCart=exports.deleteFromCart=exports.updateQuantity=exports.addToCart=exports.details=exports.login=exports.register=exports.welcome=void 0;var secret=require("../../secret/dist/secret").secret,jwt=require("jwt-simple"),_a=require("../../models/dist/usersModel"),Users=_a.Users,User=_a.User;function welcome(e,r){try{r.send({h1Text:"Shop Shop Shop",message:"We wish you happy Shopping ðŸ›’"})}catch(e){console.error(e),r.status(500).send(e.message)}}function register(e,r){try{var t,s,a=e.body,o=a.email,d=a.username,u=a.password,i=a.isAdmin,n=i?"admin":"shopper",c=i?"\n\nShopper trying to become an admin? Please verify you credentials.":"",l=(new Users).addUser(o,d,u,i),p=l.userUuid,m=l.storeUuid;p?(t=JSON.stringify({userUuid:p}),s=jwt.encode(t,secret),r.cookie("currentUser",s,{maxAge:9e5,httpOnly:!0}),r.send({title:"Cheers, "+d+"!",text:"You are our newest "+n+"!",storeUuid:m,isRegistered:!0})):r.send({title:"Email already registered",text:"Please use a different email address."+c,isRegistered:!1})}catch(e){console.error(e),r.status(500).send(e.message)}}function login(e,r){try{var t,s,a=e.body,o=a.email,d=a.password,u=a.isAdmin,i=u?"n admin":" shopper",n=(new Users).verifyUser(o,d);n?null===n.storeUuid&&!u||null!==n.storeUuid&&u?(t=JSON.stringify({userUuid:n.userUuid}),s=jwt.encode(t,secret),r.cookie("currentUser",s,{maxAge:9e5,httpOnly:!0}),r.send({title:"Welcome back, "+n.username+"!",text:"Enjoy your visit!",storeUuid:n.storeUuid,isLoggedIn:!0})):r.send({title:n.username+", you are not a"+i+"!",text:"Please use the right login form!",isLoggedIn:!1}):r.send({title:"Credentials are wrong",text:"Please verify.",isLoggedIn:!1})}catch(e){console.error(e),r.status(500).send(e.message)}}function addToCart(e,r){try{var t=e.body,s=t.productUuid,a=t.productName,o=new Users,d=e.userUuid.userUuid;o.addCartProduct(d,s),r.send({title:a+" added to your cart!",addToCart:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}function updateQuantity(e,r){try{var t=e.body,s=t.productUuid,a=t.productName,o=t.mathSign,d=new Users,u=e.userUuid.userUuid,i=d.updateCartProductQuantity(u,s,o);r.send({title:"There are now "+i+" "+a+"(s) in your cart",updateQuantity:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}function deleteFromCart(e,r){try{var t=e.body,s=t.productUuid,a=t.productName,o=new Users,d=e.userUuid.userUuid;o.deleteCartProduct(d,s),r.send({title:"You have delete "+a+" from your cart",deleteFromCart:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}function purchaseCart(e,r){try{var t=new Users,s=e.userUuid.userUuid;t.emptyCart(s),r.send({title:"Cart purchase completed",purchaseCart:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}exports.welcome=welcome,exports.register=register,exports.login=login,exports.details=function(e,r){try{var t=e.userUuid,s=e.isAdmin,a=(new Users)[t],o=a.username,d=a.cart,u=a.purchased;s?r.send({username:o}):r.send({username:o,cart:d,purchased:u})}catch(e){console.error(e),r.status(500).send(e.message)}},exports.addToCart=addToCart,exports.updateQuantity=updateQuantity,exports.deleteFromCart=deleteFromCart,exports.purchaseCart=purchaseCart;