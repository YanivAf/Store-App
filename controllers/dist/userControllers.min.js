"use strict";exports.__esModule=!0,exports.purchaseCart=exports.deleteFromCart=exports.updateQuantity=exports.details=exports.logout=exports.login=exports.register=exports.welcome=void 0;var secret=require("../../secret/dist/secret").secret,jwt=require("jsonwebtoken"),_a=require("../../models/dist/usersModel"),Users=_a.Users,User=_a.User,CartProduct=_a.CartProduct,_b=require("../../models/dist/storesModel"),Product=_b.Product,Store=_b.Store,Stores=_b.Stores;function welcome(e,r){try{var s=e.userIndex,t=e.isAdmin,o=(new Users).users[s],u=o.username,n=o.stores;r.send({isAdmin:t,storeUuid:n[0],h1Text:"Shop Shop Shop",message:u+", you're already logged in"})}catch(e){console.error(e),r.status(500).send(e.message)}}function register(e,r){try{var s=e.body,t=s.email,o=s.username,u=s.password,n=e.shopperToAdmin,a=e.userIndex,d=e.role,i=(new Users).addUser(t,o,u,n,a,d),c=i.userUuid,p=i.storeUuid,l=jwt.sign({userUuid:c},secret,{expiresIn:3600});r.cookie("currentUser",l,{maxAge:36e5,httpOnly:!0}),r.send({title:"Cheers, "+o+"!",text:"You are our newest "+d+"!",storeUuid:p})}catch(e){console.error(e),r.status(500).send(e.message)}}function login(e,r){try{var s,t=e.body.adminLoginForm,o=e.userIndex,u=e.role,n=new Users,a=n.users[o],d=a.username,i=a.userUuid,c=a.stores,p="admin"===u?"n admin":" shopper";!t&&"shopper"===u||t&&"admin"===u?(s=jwt.sign({userUuid:i},secret,{expiresIn:3600}),r.cookie("currentUser",s,{maxAge:36e5,httpOnly:!0}),"shopper"===u&&n.restoreCart(o),r.send({title:"Welcome back, "+d+"!",text:"Enjoy your visit!",storeUuid:c[0],isLoggedIn:!0})):r.send({title:d+", you are not a"+p+"!",text:"Please use the right login form!",isLoggedIn:!1})}catch(e){console.error(e),r.status(500).send(e.message)}}function logout(e,r){try{var s=e.userIndex,t=(new Users).users[s].username;r.clearCookie("currentUser"),r.send({username:t})}catch(e){console.error(e),r.status(500).send(e.message)}}function updateQuantity(e,r){try{var s,t=e.body,o=t.productUuid,u=t.productQuantity,n=t.allStoresInfo,a=new Users,d=e.userIndex,i=e.cartProductIndex,c=e.storeUuid,p=e.storeIndex,l=e.productIndex,m=a.updateCartProductQuantity(d,i,p,c,o,l,u),g=a.users[d].savedForLater,x=new Stores;n&&(s=[],x.stores.forEach(function(e){s=s.concat(e.products)}));var h=null!=s?s:x.stores[p].products,U=a.users[d].shippingAddress;r.send({cartProducts:m,storeProducts:h,savedProducts:g,shippingAddress:U})}catch(e){console.error(e),r.status(500).send(e.message)}}function deleteFromCart(e,r){try{var s=e.body,t=s.productUuid,o=s.productName,u=new Users,n=e.userUuid.userUuid;u.deleteCartProduct(n,t),r.send({title:"You have delete "+o+" from your cart",deleteFromCart:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}function purchaseCart(e,r){try{var s=new Users,t=e.userIndex;s.emptyCart(t),r.send({title:"Cart purchase completed",purchaseCart:!0})}catch(e){console.error(e),r.status(500).send(e.message)}}exports.welcome=welcome,exports.register=register,exports.login=login,exports.logout=logout,exports.details=function(e,r){try{var s=e.userIndex,t=e.isAdmin,o=(new Users).users[s];r.send({user:o,isUserAdmin:t})}catch(e){console.error(e),r.status(500).send(e.message)}},exports.updateQuantity=updateQuantity,exports.deleteFromCart=deleteFromCart,exports.purchaseCart=purchaseCart;