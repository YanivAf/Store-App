"use strict";exports.__esModule=!0,exports.login=exports.register=exports.showProducts=exports.showStores=exports.welcome=void 0;var secret=require("../../secret/dist/secret").secret,jwt=require("jwt-simple"),_a=require("../../models/dist/usersModel"),Users=_a.Users,User=_a.User;function welcome(e,s){try{s.send({h1Text:"Shop Shop Shop",message:"We wish you happy Shopping ðŸ›’"})}catch(e){console.error(e),s.status(500).send(e.message)}}function register(e,s){try{var r,t,o=e.body,i=o.email,n=o.username,d=o.password,a=o.isAdmin,u=a?"admin":"shopper",c=a?"\n\nShopper trying to become an admin? Please verify you credentials.":"",l=(new Users).addUser(i,n,d,a),g=l.userUuid,m=l.storeUuid;g?(r=JSON.stringify({userUuid:g}),t=jwt.encode(r,secret),s.cookie("currentUser",t,{maxAge:9e5,httpOnly:!0}),s.send({title:"Cheers, "+n+"!",text:"You are our newest "+u+"!",storeUuid:m,isRegistered:!0})):s.send({title:"Email already registered",text:"Please use a different email address."+c,isRegistered:!1})}catch(e){console.error(e),s.status(500).send(e.message)}}function login(e,s){try{var r,t,o=e.body,i=o.email,n=o.password,d=o.isAdmin,a=d?"n admin":" shopper",u=(new Users).verifyUser(i,n);u?null===u.storeUuid&&!d||null!==u.storeUuid&&d?(r=JSON.stringify({userUuid:u.userUuid}),t=jwt.encode(r,secret),s.cookie("currentUser",t,{maxAge:9e5,httpOnly:!0}),s.send({title:"Welcome back, "+u.username+"!",text:"Enjoy your visit!",isLoggedIn:!0})):s.send({title:u.username+", you are not a"+a+"!",text:"Please use the right login form!",isLoggedIn:!1}):s.send({title:"Credentials are wrong",text:"Please verify.",storeUuid:u.storeUuid,isLoggedIn:!1})}catch(e){console.error(e),s.status(500).send(e.message)}}exports.welcome=welcome,exports.showStores=function(e,s){try{s.send({showStores:!0})}catch(e){console.error(e),s.status(500).send(e.message)}},exports.showProducts=function(e,s){try{s.send({showProducts:!0})}catch(e){console.error(e),s.status(500).send(e.message)}},exports.register=register,exports.login=login;