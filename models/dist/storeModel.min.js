"use strict";exports.__esModule=!0,exports.Store=exports.PurchasedCart=exports.Product=exports.readStoreJson=exports.productImgStorage=void 0;var uuidv4=require("uuid").v4,multer=require("multer"),fs=require("fs"),path=require("path"),storeJsonPath=path.resolve(__dirname,"../store.json"),CartProduct=require("./usersModel").CartProduct;exports.productImgStorage=multer.diskStorage({destination:"./public/images",filename:function(t,r,e){e(null,r.originalname+"-"+Date.now()+path.extname(r.originalname))}}),exports.readStoreJson=function(){try{var t=fs.readFileSync(storeJsonPath);return JSON.parse(t)}catch(t){console.error(t.message)}};var Product=function(t,r,e,o,s,u,i){this.productUuid=t||uuidv4(),this.storeUuid=r,this.productName=e,this.productDescription=o,this.productPrice=s,this.productImage="images/"+u,this.inStock=i};exports.Product=Product;var PurchasedCart=function(t,r,e,o){this.purchasedCartProducts=t,this.shopperEmail=r,this.shopperUsername=e,this.shopperUuid=o};exports.PurchasedCart=PurchasedCart;var Store=function(){function t(){var t=exports.readStoreJson();this.storeUuid=t.storeUuid,this.storeName=t.storeName,this.products=t.products,this.purchasedCarts=t.purchasedCarts}return t.prototype.updateStoreJson=function(){try{fs.writeFileSync(storeJsonPath,JSON.stringify({storeUuid:this.storeUuid,storeName:this.storeName,products:this.products,purchasedCarts:this.purchasedCarts}))}catch(t){console.error(t.message)}},t.prototype.updateStoreName=function(t){try{this.storeName=t,this.updateStoreJson()}catch(t){console.error(t.message)}},t.prototype.findProductIndex=function(r){try{return this.products.findIndex(function(t){return t.productUuid===r})}catch(t){console.error(t.message)}},t.prototype.addProduct=function(t,r,e,o,s,u){try{var i=new Product(void 0,this.storeUuid,t,r,e,o,s);this.products.push(i),this.updateStoreJson()}catch(t){console.error(t.message)}},t.prototype.editProduct=function(t,r,e,o,s,u){try{var i=new Product(t,this.storeUuid,r,e,o,s,u),a=this.findProductIndex(t);this.products[a]=i,this.updateStoreJson()}catch(t){console.error(t.message)}},t.prototype.deleteProduct=function(r){try{this.products=this.products.filter(function(t){return t.productUuid!==r}),this.updateStoreJson()}catch(t){console.error(t.message)}},t.prototype.addPurchesedCart=function(t,r,e,o){try{var s=new PurchasedCart(t,r,e,o);this.purchasedCarts.push(s),this.updateStoreJson()}catch(t){console.error(t.message)}},t}();exports.Store=Store;