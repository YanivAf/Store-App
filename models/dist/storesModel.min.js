"use strict";exports.__esModule=!0,exports.Stores=exports.Store=exports.PurchasedCart=exports.Product=exports.readStoresJson=void 0;var uuidv4=require("uuid").v4,fs=require("fs"),path=require("path"),storesJsonPath=path.resolve(__dirname,"../stores.json"),CartProduct=require("./usersModel").CartProduct;exports.readStoresJson=function(){try{var t=fs.readFileSync(storesJsonPath);return JSON.parse(t)}catch(t){console.error(t.message)}};var Product=function(t,r,e,s,o,i,n,u,d,c,a){this.storeUuid=t,this.productUuid=null!=r?r:uuidv4(),this.productName=e,this.createdAt=s,this.lastEditedAt=o,this.lastEditedBy=i,this.productDescription=n,this.productPrice=u,this.precentsOff=null!=d?d:0,this.productImage=c?"images/"+c:"images/cart-wp.png",this.inStock=a};exports.Product=Product;var PurchasedCart=function(t,r,e,s,o){this.purchasedCartUuid=uuidv4(),this.purchasedCartProducts=t,this.shopperEmail=e,this.shopperUsername=s,this.shopperUuid=o,this.shippingAddress=r,this.purchasedAt=new Date};exports.PurchasedCart=PurchasedCart;var Store=function(t){this.storeUuid=uuidv4(),this.storeName="Untitled Store",this.createdAt=new Date,this.storeAdminsUuids=t,this.lastEditedAt=null,this.lastEditedBy=null,this.products=[],this.purchasedCarts=[]};exports.Store=Store;var Stores=function(){function t(){this.stores=exports.readStoresJson()}return t.prototype.updateStoresJson=function(){try{fs.writeFileSync(storesJsonPath,JSON.stringify(this.stores))}catch(t){console.error(t.message)}},t.prototype.findStoreIndex=function(r){try{return this.stores.findIndex(function(t){return t.storeUuid===r})}catch(t){console.error(t.message)}},t.prototype.addStore=function(t){try{var r=new Store(t);return this.stores.push(r),this.stores.length-1}catch(t){console.error(t.message)}},t.prototype.findStoreProductIndex=function(t,r){try{return this.stores[t].products.findIndex(function(t){return t.productUuid===r})}catch(t){console.error(t.message)}},t.prototype.updateStoreName=function(t,r){try{var e=this.findStoreIndex(r);this.stores[e].storeName=t,this.updateStoresJson()}catch(t){console.error(t.message)}},t.prototype.addProduct=function(t,r,e,s,o,i,n){try{var u=this.findStoreIndex(t),d=new Product(t,void 0,r,new Date,null,null,e,s,o,i,n);return this.stores[u].products.push(d),this.updateStoresJson(),this.stores[u]}catch(t){console.error(t.message)}},t.prototype.editProduct=function(t,r,e,s,o,i,n,u,d){try{var c=this.findStoreIndex(t),a=new Product(t,e,s,null,new Date,r,o,i,n,u,d),h=this.findStoreProductIndex(c,e);u||(a.productImage=this.stores[c].products[h].productImage),a.createdAt=this.stores[c].products[h].createdAt,this.stores[c].products[h]=a,this.updateStoresJson()}catch(t){console.error(t.message)}},t.prototype.deleteProduct=function(t,r){try{var e=this.findStoreIndex(t);this.stores[e].products=this.stores[e].products.filter(function(t){return t.productUuid!==r}),this.updateStoresJson()}catch(t){console.error(t.message)}},t.prototype.addPurchesedCart=function(t,e,s,o,i){try{var n,u;this.stores.forEach(function(r){u=t.filter(function(t){return t.storeUuid===r.storeUuid}),n=new PurchasedCart(u,e,s,o,i),r.purchasedCarts.push(n)}),this.updateStoresJson()}catch(t){console.error(t.message)}},t}();exports.Stores=Stores;