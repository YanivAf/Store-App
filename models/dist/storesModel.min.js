"use strict";exports.__esModule=!0,exports.Stores=exports.Store=exports.PurchasedCart=exports.Product=exports.Review=exports.readStoresJson=void 0;var uuidv4=require("uuid").v4,fs=require("fs"),path=require("path"),storesJsonPath=path.resolve(__dirname,"../stores.json"),CartProduct=require("./usersModel").CartProduct;exports.readStoresJson=function(){try{var t=fs.readFileSync(storesJsonPath);return JSON.parse(t)}catch(t){console.error(t.message)}};var Review=function(t,e,r,s,o,i){this.reviewUuid=uuidv4(),this.createdAt=new Date,this.lastEditedAt=null,this.rating=t,this.feedback=e,this.shopperEmail=r,this.shopperUsername=s,this.shopperUuid=o,this.response=i,this.responseAt=new Date};exports.Review=Review;var Product=function(t,e,r,s,o,i,n,d,u,c,a){this.storeUuid=t,this.productUuid=null!=e?e:uuidv4(),this.productName=r,this.createdAt=s,this.lastEditedAt=o,this.lastEditedBy=i,this.productDescription=n,this.productPrice=d,this.precentsOff=null!=u?u:0,this.productImage=c?"images/"+c:"images/cart-wp.png",this.inStock=a,this.sold=0,this.loved=0,this.reviews=[]};exports.Product=Product;var PurchasedCart=function(t,e,r,s,o,i){this.purchasedCartUuid=t,this.purchasedCartProducts=e,this.shopperEmail=s,this.shopperUsername=o,this.shopperUuid=i,this.shippingAddress=r,this.purchasedAt=new Date};exports.PurchasedCart=PurchasedCart;var Store=function(t,e){this.storeUuid=uuidv4(),this.storeName="Untitled Store",this.createdAt=new Date,this.storeAdminsUuids=t,this.contactEmail=e,this.lastEditedAt=null,this.lastEditedBy=null,this.products=[],this.purchasedCarts=[],this.createdCartsCounter=0,this.reviews=[]};exports.Store=Store;var Stores=function(){function t(){this.stores=exports.readStoresJson()}return t.prototype.updateStoresJson=function(){try{fs.writeFileSync(storesJsonPath,JSON.stringify(this.stores))}catch(t){console.error(t.message)}},t.prototype.findStoreIndex=function(e){try{return this.stores.findIndex(function(t){return t.storeUuid===e})}catch(t){console.error(t.message)}},t.prototype.addStore=function(t,e){try{var r=new Store(t,e);return this.stores.push(r),this.stores.length-1}catch(t){console.error(t.message)}},t.prototype.findStoreProductIndex=function(t,e){try{return this.stores[t].products.findIndex(function(t){return t.productUuid===e})}catch(t){console.error(t.message)}},t.prototype.updateStoreName=function(t,e){try{var r=this.findStoreIndex(e);this.stores[r].storeName=t,this.updateStoresJson()}catch(t){console.error(t.message)}},t.prototype.addProduct=function(t,e,r,s,o,i,n){try{var d=this.findStoreIndex(t),u=new Product(t,void 0,e,new Date,null,null,r,s,o,i,n);return this.stores[d].products.push(u),this.updateStoresJson(),this.stores[d]}catch(t){console.error(t.message)}},t.prototype.editProduct=function(t,e,r,s,o,i,n,d,u){try{var c=this.findStoreIndex(t),a=new Product(t,r,s,null,new Date,e,o,i,n,d,u),h=this.findStoreProductIndex(c,r);d||(a.productImage=this.stores[c].products[h].productImage),a.createdAt=this.stores[c].products[h].createdAt,this.stores[c].products[h]=a,this.updateStoresJson()}catch(t){console.error(t.message)}},t.prototype.deleteProduct=function(t,e){try{var r=this.findStoreIndex(t);this.stores[r].products=this.stores[r].products.filter(function(t){return t.productUuid!==e}),this.updateStoresJson()}catch(t){console.error(t.message)}},t.prototype.addPurchesedCart=function(t,e,s,o,i,n){try{var d,u;this.stores.forEach(function(r){(u=e.filter(function(t){return t.storeUuid===r.storeUuid})).forEach(function(e){r.products.forEach(function(t){e.productUuid===t.productUuid&&(t.inStock-=e.quantity,t.sold+=e.quantity)})}),d=new PurchasedCart(t,u,s,o,i,n),r.purchasedCarts.push(d)}),this.updateStoresJson()}catch(t){console.error(t.message)}},t}();exports.Stores=Stores;