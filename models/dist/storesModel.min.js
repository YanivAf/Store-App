"use strict";exports.__esModule=!0,exports.Stores=exports.Store=exports.PurchasedCart=exports.Product=exports.readStoresJson=void 0;var uuidv4=require("uuid").v4,fs=require("fs"),path=require("path"),storesJsonPath=path.resolve(__dirname,"../stores.json"),CartProduct=require("./usersModel").CartProduct;exports.readStoresJson=function(){try{var t=fs.readFileSync(storesJsonPath);return JSON.parse(t)}catch(t){console.error(t.message)}};var Product=function(t,r,e,s,o,i,n,u,d,c,a){this.storeUuid=t,this.productUuid=null!=r?r:uuidv4(),this.productName=e,this.createdAt=s,this.lastEditedAt=o,this.lastEditedBy=i,this.productDescription=n,this.productPrice=u,this.precentsOff=null!=d?d:0,this.productImage=c?"images/"+c:"images/cart-wp.png",this.inStock=a,this.sold=0};exports.Product=Product;var PurchasedCart=function(t,r,e,s,o,i){this.purchasedCartUuid=t,this.purchasedCartProducts=r,this.shopperEmail=s,this.shopperUsername=o,this.shopperUuid=i,this.shippingAddress=e,this.purchasedAt=new Date};exports.PurchasedCart=PurchasedCart;var Store=function(t,r){this.storeUuid=uuidv4(),this.storeName="Untitled Store",this.createdAt=new Date,this.storeAdminsUuids=t,this.lastEditedAt=null,this.lastEditedBy=null,this.products=[],this.purchasedCarts=[],this.contactEmail=r};exports.Store=Store;var Stores=function(){function t(){this.stores=exports.readStoresJson()}return t.prototype.updateStoresJson=function(){try{fs.writeFileSync(storesJsonPath,JSON.stringify(this.stores))}catch(t){console.error(t.message)}},t.prototype.findStoreIndex=function(r){try{return this.stores.findIndex(function(t){return t.storeUuid===r})}catch(t){console.error(t.message)}},t.prototype.addStore=function(t,r){try{var e=new Store(t,r);return this.stores.push(e),this.stores.length-1}catch(t){console.error(t.message)}},t.prototype.findStoreProductIndex=function(t,r){try{return this.stores[t].products.findIndex(function(t){return t.productUuid===r})}catch(t){console.error(t.message)}},t.prototype.updateStoreName=function(t,r){try{var e=this.findStoreIndex(r);this.stores[e].storeName=t,this.updateStoresJson()}catch(t){console.error(t.message)}},t.prototype.addProduct=function(t,r,e,s,o,i,n){try{var u=this.findStoreIndex(t),d=new Product(t,void 0,r,new Date,null,null,e,s,o,i,n);return this.stores[u].products.push(d),this.updateStoresJson(),this.stores[u]}catch(t){console.error(t.message)}},t.prototype.editProduct=function(t,r,e,s,o,i,n,u,d){try{var c=this.findStoreIndex(t),a=new Product(t,e,s,null,new Date,r,o,i,n,u,d),h=this.findStoreProductIndex(c,e);u||(a.productImage=this.stores[c].products[h].productImage),a.createdAt=this.stores[c].products[h].createdAt,this.stores[c].products[h]=a,this.updateStoresJson()}catch(t){console.error(t.message)}},t.prototype.deleteProduct=function(t,r){try{var e=this.findStoreIndex(t);this.stores[e].products=this.stores[e].products.filter(function(t){return t.productUuid!==r}),this.updateStoresJson()}catch(t){console.error(t.message)}},t.prototype.addPurchesedCart=function(t,r,s,o,i,n){try{var u,d;this.stores.forEach(function(e){(d=r.filter(function(t){return t.storeUuid===e.storeUuid})).forEach(function(r){e.products.forEach(function(t){r.productUuid===t.productUuid&&(t.inStock-=r.quantity,t.sold+=r.quantity)})}),u=new PurchasedCart(t,d,s,o,i,n),e.purchasedCarts.push(u)}),this.updateStoresJson()}catch(t){console.error(t.message)}},t}();exports.Stores=Stores;