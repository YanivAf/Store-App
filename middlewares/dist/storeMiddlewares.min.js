"use strict";exports.__esModule=!0,exports.enoughInStock=exports.doesProductExist=exports.doesStoreExist=void 0;var _a=require("../../models/dist/storesModel"),Product=_a.Product,Store=_a.Store,Stores=_a.Stores,_b=require("../../models/dist/usersModel"),CartProduct=_b.CartProduct,User=_b.User,Users=_b.Users;function doesStoreExist(e,r,t){var o;try{var s,d=new Stores,n=null!==(o=e.params.storeUuid)&&void 0!==o?o:e.body.storeUuid;if("mall"===n)return void t();if("all cart products stores"!==n)return void(-1===(s=d.findStoreIndex(n))?r.status(404).send({message:"Store doesn't exist anymore. Apologies for the inconvenience."}):(e.storeUuid=n,e.storeIndex=s,t()));var u=new Users,a=e.userIndex,c=!1,i="";return u.users[a].cart.forEach(function(e){n=e.storeUuid,-1===(s=d.findStoreIndex(n))&&(c=!0,i+='"'+e.productName+'", ')}),void(c?(i.replace(/[,][ ]$/g,""),r.status(404).send({message:"Store of "+i+" doesn't exist anymore. To continue, please adjust your cart accordingly."})):t())}catch(e){console.error(e.message),r.status(500).send(e.message)}}function doesProductExist(e,r,t){var o;try{var s,d=new Stores,n=new Users,u=e.userIndex,a=null!==(o=e.params.productUuid)&&void 0!==o?o:e.body.productUuid,c=e.storeIndex;if("all cart products"===a){var i,p,x=0,l="";return n.users[u].cart.forEach(function(e){i=e.storeUuid,a=e.productUuid,c=d.findStoreIndex(i),-1===(s=d.findStoreProductIndex(c,a))&&(x++,l='"'+e.productName+'", ')}),void(0<x?(p=1<x?"don't":"doesn't",l.replace(/[,][ ]$/g,""),r.status(404).send({message:l+" "+p+" exist anymore. To continue, please adjust your cart accordingly."})):t())}s=d.findStoreProductIndex(c,a);var S=n.findCartProduct(u,a);return void(-1===s?r.status(404).send({message:'"'+n.users[u].cart[S].productName+"\" doesn't exist anymore. Apologies for the inconvenience."}):(e.productIndex=s,e.cartProductIndex=S,t()))}catch(e){console.error(e.message),r.status(500).send(e.message)}}function enoughInStock(e,r,t){var o;try{var s=new Stores,d=new Users,n=e.userIndex,u=e.body.productQuantity,a=e.storeIndex,c=e.productIndex,i=e.cartProductIndex,p=e.storeUuid,x=null!==(o=e.params.productUuid)&&void 0!==o?o:e.body.productUuid;if("all cart products"===x){i=0;var l,S,m=!1;return d.users[n].cart.forEach(function(e){p=e.storeUuid,x=e.productUuid,a=s.findStoreIndex(p),c=s.findStoreProductIndex(a,x),e.inStockMirror=s.stores[a].products[c].inStock,e.inStockMirror<e.quantity&&(m=!0,l=e,S=s.stores[a].products[c]),i++}),void(m?r.status(409).send({message:"There are "+l.inStockMirror+' "'+S.productName+'"s in stock. To continue, please adjust quantity (or save the product for later!)'}):t())}var v=s.stores[a].products[c].inStock,f=s.stores[a].products[c].productName,i=-1===i?d.addCartProduct(n,p,x,f,v):i;return d.users[n].cart[i].inStockMirror=s.stores[a].products[c].inStock,void(d.users[n].cart[i].inStockMirror<u?r.status(409).send({message:"There are "+d.users[n].cart[i].inStockMirror+' "'+s.stores[a].products[c].productName+'"s in stock. To continue, please adjust quantity (or save the product for later!)'}):t())}catch(e){console.error(e.message),r.status(500).send(e.message)}}exports.doesStoreExist=doesStoreExist,exports.doesProductExist=doesProductExist,exports.enoughInStock=enoughInStock;