"use strict";exports.__esModule=!0,exports.enoughInStock=exports.doesProductExist=exports.doesStoreExist=void 0;var _a=require("../../models/dist/storesModel"),Product=_a.Product,Store=_a.Store,Stores=_a.Stores,_b=require("../../models/dist/usersModel"),CartProduct=_b.CartProduct,User=_b.User,Users=_b.Users;function doesStoreExist(e,r,t){var o;try{var s,d=new Stores,n=null!==(o=e.params.storeUuid)&&void 0!==o?o:e.body.storeUuid;if("mall"===n)return void t();if("all cart products stores"!==n)return void(-1===(s=d.findStoreIndex(n))?r.status(404).send({message:"Store doesn't exist. Apologies for the inconvenience."}):(e.storeUuid=n,e.storeIndex=s,t()));var u=new Users,c=e.userIndex;return u.users[c].cart.forEach(function(e){n=e.storeUuid,-1!==(s=d.findStoreIndex(n))||r.status(404).send({message:'Store of "'+e.productName+"\" doesn't exist anymore. To continue, please delete it from your cart."})}),void t()}catch(e){console.error(e.message),r.status(500).send(e.message)}}function doesProductExist(e,r,t){var o;try{var s,d,n=new Stores,u=new Users,c=e.userIndex,a=null!==(o=e.params.productUuid)&&void 0!==o?o:e.body.productUuid,i=e.storeIndex;if("all cart products"===a)return u.users[c].cart.forEach(function(e){d=e.storeUuid,a=e.productUuid,i=n.findStoreIndex(d),-1!==(s=n.findStoreProductIndex(i,a))||r.status(404).send({message:'"'+e.productName+"\" doesn't exist anymore. To continue, please delete it from your cart."})}),void t();s=n.findStoreProductIndex(i,a);var p=u.findCartProduct(c,a);return void(-1===s?r.status(404).send({message:"Product doesn't exist. Apologies for the inconvenience."}):(e.productIndex=s,e.cartProductIndex=p,t()))}catch(e){console.error(e.message),r.status(500).send(e.message)}}function enoughInStock(e,r,t){var o;try{var s=new Stores,d=new Users,n=e.userIndex,u=e.body.productQuantity,c=e.storeIndex,a=e.productIndex,i=e.cartProductIndex,p=e.storeUuid,x=null!==(o=e.params.productUuid)&&void 0!==o?o:e.body.productUuid;if("all cart products"===x){return d.users[n].cart.forEach(function(e){p=e.storeUuid,x=e.productUuid,c=s.findStoreIndex(p),a=s.findStoreProductIndex(c,x),e.inStockMirror=s.stores[c].products[a].inStock,s.stores[c].products[a].inStockMirror<u?r.status(409).send({message:"There are only "+e.inStockMirror+' "'+s.stores[c].products[a].productName+'"s in stock. To continue, please adjust quantity (or save the product for later!)'}):0}),void t()}var l=s.stores[c].products[a].inStock,S=s.stores[c].products[a].productName,i=-1===i?d.addCartProduct(n,p,x,S,l):i;return d.users[n].cart[i].inStockMirror=s.stores[c].products[a].inStock,void(d.users[n].cart[i].inStockMirror<u?r.status(409).send({message:"There are only "+d.users[n].cart[i].inStockMirror+' "'+s.stores[c].products[a].productName+'"s in stock. To continue, please adjust quantity (or save the product for later!)'}):t())}catch(e){console.error(e.message),r.status(500).send(e.message)}}exports.doesStoreExist=doesStoreExist,exports.doesProductExist=doesProductExist,exports.enoughInStock=enoughInStock;