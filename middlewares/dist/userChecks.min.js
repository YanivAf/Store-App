"use strict";exports.__esModule=!0,exports.adminStoreUuid=exports.onlyAdmin=exports.onlyShopper=exports.isAdmin=exports.doesUserExist=exports.isLoggedIn=void 0;var secret=require("../../secret/dist/secret").secret,jwt=require("jwt-simple"),Users=require("../../models/dist/usersModel").Users;function isLoggedIn(e,s,r){try{var o,t,n=e.cookies.currentUser;n?(o=jwt.decode(n,secret),t=JSON.parse(o),e.currentUser=t,r()):s.status(401).send({message:"The session has expired. Please log in again."})}catch(e){console.error(e.message),s.status(500).send(e.message)}}function doesUserExist(e,s,r){try{var o=e.currentUser.userUuid,t=(new Users).findUserIndex(o,null);if(void 0===t)throw new Error("The user was not found.");e.userUuid=o,e.userIndex=t,r()}catch(e){console.error(e.message),s.status(500).send(e.message)}}function isAdmin(e,s,r){try{var o=new Users,t=e.userIndex;e.isAdmin=null!==o.users[t].storeUuid,r()}catch(e){console.error(e.message),s.status(500).send(e.message)}}function onlyShopper(e,s,r){try{e.isAdmin?s.status(401).send({message:"This functionality is for shoppers only."}):r()}catch(e){console.error(e.message),s.status(500).send(e.message)}}function onlyAdmin(e,s,r){try{e.isAdmin?r():s.status(401).send({message:"You are not authorized to see this page."})}catch(e){console.error(e.message),s.status(500).send(e.message)}}function adminStoreUuid(e,s,r){try{var o=new Users,t=e.userIndex,n=e.isAdmin;e.adminStoreUuid=n?o.users[t].storeUuid:null,r()}catch(e){console.error(e.message),s.status(500).send(e.message)}}exports.isLoggedIn=isLoggedIn,exports.doesUserExist=doesUserExist,exports.isAdmin=isAdmin,exports.onlyShopper=onlyShopper,exports.onlyAdmin=onlyAdmin,exports.adminStoreUuid=adminStoreUuid;