var __awaiter=this&&this.__awaiter||function(t,c,a,s){return new(a=a||Promise)(function(r,e){function o(t){try{i(s.next(t))}catch(t){e(t)}}function n(t){try{i(s.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,n)}i((s=s.apply(t,c||[])).next())})},__generator=this&&this.__generator||function(r,o){var n,i,c,a={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(c=2&e[0]?i.return:e[0]?i.throw||((c=i.return)&&c.call(i),0):i.next)&&!(c=c.call(i,e[1])).done)return c;switch(i=0,c&&(e=[2&e[0],c.value]),e[0]){case 0:case 1:c=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,i=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(c=0<(c=a.trys).length&&c[c.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!c||e[1]>c[0]&&e[1]<c[3])){a.label=e[1];break}if(6===e[0]&&a.label<c[1]){a.label=c[1],c=e;break}if(c&&a.label<c[2]){a.label=c[2],a.ops.push(e);break}c[2]&&a.ops.pop(),a.trys.pop();continue}e=o.call(r,a)}catch(t){e=[6,t],i=0}finally{n=c=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};function getStore(){return __awaiter(this,void 0,void 0,function(){var e,r,o,n,i;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,axios.get("/store/"+storeUuid)];case 1:return e=t.sent(),r=e.data,o=r.stores,n=r.store,renderStore(o,n,isAdmin),[3,3];case 2:return i=t.sent(),console.error(i.message),[3,3];case 3:return[2]}})})}function renderStore(t,e,r){try{var o,n,i=void 0;t?(i="Virtual Mall",o=[],t.stores.forEach(function(t){o=o.concat(t.products)})):(i=e.storeName,o=e.products),document.querySelector(".main__item--store-name").innerText=i,document.querySelector("title").innerText=i,renderStoreProducts(o,cartProductsToRender,lovedProducts,r),r?renderProductForm():e&&((n=document.querySelector("#contact")).setAttribute("href","mailto:"+e.contactEmail+"?subject="+e.storeName+" - General Inquiry"),n.innerHTML='<i class="far fa-envelope" title="Contact us!"></i>')}catch(t){console.error(t.message)}}function renderStoreProducts(t,u,l,p){try{var e=document.querySelector(".products"),r=0<t.length?t.map(function(e){var t,r,o="";o=p?"":(storeUuid&&(o='\n                <a href="./store.html?storeUuid='+e.storeUuid+'" class="product-buttons__item product-buttons__item--store">\n                    <i class="fas fa-store" title="Go to '+e.productName+"'s store\"></i>\n                </a>"),t=-1!==l.findIndex(function(t){return t===e.productUuid})?'<i class="product-buttons__item product-buttons__item--product-loved fas fa-heart product-loved" title="Unlove '+e.productName+'"></i>':'<i class="product-buttons__item product-buttons__item--love-product far fa-heart love-product" title="Love '+e.productName+'"></i>',-1===u.findIndex(function(t){return t.productUuid===e.productUuid})?'<i class="product-buttons__item product-buttons__item--cart-add fas fa-cart-plus add-to-cart" title="Add '+e.productName+' to cart"></i>\n                '+t+"\n                "+o:'\n                <a href="./cart.html" class="product-buttons__item product-buttons__item--cart-added">\n                    <i class="fas fa-shopping-cart" title="See '+e.productName+' in your cart"></i>\n                </a>\n                '+t+"\n                "+o);var n=0<e.inStock,i=n?(r=p?e.inStock+" left":5<e.inStock?"In Stock":"Running Out!",5<e.inStock?"green":"orange"):(r="Out of Stock","red"),c="",a="";0<e.precentsOff&&(c='<h5 class="product__item product__item--sale">'+e.precentsOff+"% off!</h5>",a='<br /><span style="font-size: 12px; color: lightgrey; text-decoration: line-through;">'+(Math.round(100*e.productPrice)/100).toFixed(2)+"$</span>");var s=e.sold<10&&!p?'<div class="sold">New product!</div>':'<div class="sold">'+e.sold+" sold</div>",d=p?'<div class="loved">'+e.loved+' <i class="fas fa-heart"></i></div>':"";return p||n?'<div class="products__item product" id="'+e.productUuid+'">\n                '+c+'\n                <h3 class="product__item product__item--name">'+e.productName+'</h3>\n                <a href="./product.html?storeUuid='+e.storeUuid+"&productUuid="+e.productUuid+'" class="product__item product__item--img">\n                    <img src="'+e.productImage+'" title="'+e.productName+'"/>\n                </a>\n                <a href="./product.html?storeUuid='+e.storeUuid+"&productUuid="+e.productUuid+'" title="Click for full description" class="product__item product__item--description">'+e.productDescription+'</a>\n                <h4 class="product__item product__item--price">'+(Math.round(100*(e.productPrice-e.productPrice*(e.precentsOff/100)))/100).toFixed(2)+"$"+a+'</h4>\n                <div class="product__item product__item--stats">\n                    '+s+"\n                    "+d+'\n                </div>\n                <div class="product__item product__item--stock" style="color:'+i+'">'+r+'</div>\n                <div class="product__item product-buttons">'+o+"</div>\n                \n            </div>":""}).join(""):"no products to show!";e.innerHTML=r}catch(t){console.error(t.message)}}function renderProductForm(){try{var t=document.querySelector("#add-product-form");t.style.display="flex";t.innerHTML='\n        <div class="product-large__item product-large__item--img">\n            <img id="product-preview" src="./images/cart-wp.png">\n            <input id="product-image" class="button" type="file" name="productImage" accept="image/*" onchange="readURL(this)" />\n        </div>\n        <div class="product-large__item details">\n            <input class="details__item details__item--name" type="text" name="productName" minLength="2" maxLength="40" placeholder="Product Name" required />\n            <div class="details__item details__item--sale">\n                <input type="number" name="precentsOff" min="0" max="100" placeholder="% Off" />\n                <label for="precentsOff">% Off</label>\n            </div>\n            <textarea class="details__item details__item--description" name="productDescription" minLength="10" maxLength="300" placeholder="Product Description (10-300 characters)" required></textarea>\n            <div class="details__item details__item--price">\n                <input type="number" name="productPrice" min="0" max="5000" placeholder="Price ($)" step=".01" pattern="^\\d+(?:\\.\\d{1,2})?$" required />\n                <label for="productPrice">Price ($)</label>\n            </div>\n            <div class="details__item details__item--in-stock">\n                <input type="number" name="productInStock" min="0" max="500" placeholder="In Stock" required />\n                <label for="productInStock">In Stock</label>\n            </div>        \n            <input class="details__item details__item--submit button" type="submit" value="Add" />\n        </div>'}catch(t){console.error(t.message)}}getStore();